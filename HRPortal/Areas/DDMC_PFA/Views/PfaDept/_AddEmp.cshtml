@Scripts.Render("~/bundles/validate")

@{
    ViewBag.Title = "SelEmp";
}

<style>
    .form-horizontal .form-group {
        margin-right: -15px;
        margin-left: 5px;
    }
</style>
@using (Html.BeginForm("SelEmp", "PfaDept", FormMethod.Post, new { Id = "SelEmpForm" }))
{
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button id="btnExit" type="button" class="close">&times;</button>
                <h4 class="modal-title">員工查詢</h4>
            </div>
            <div class="modal-body">
                <div>
                    <div class="search-container" style="margin-right: 0px; border-left-width: 5px; margin-left: 0px;">
                        <div class="search-section">
                            <div class="col-xs-6">
                                <div class="search-name">
                                    <label>公司別</label>
                                </div>
                                <div class="search-input">
                                    @ViewBag.CompanyName
                                    <input type="hidden" value="@ViewBag.CompanyID" name="txtCompanyID" id="txtCompanyID" />
                                    <input type="hidden" value="@ViewBag.PfaDeptID" name="txtPfaDeptID" id="txtPfaDeptID" />
                                </div>
                            </div>
                            <div class="col-xs-6">
                                <div class="search-name">
                                    <label>部門名稱</label>
                                </div>
                                <div class="search-input">
                                    @Html.DropDownList("ddlDept", (IEnumerable<SelectListItem>)ViewData["DeptList"], new { @id = "ddlDept", @class = "form-control" })
                                </div>
                            </div>
                        </div>
                        <div class="search-section">
                            <div class="col-xs-6">
                                <div class="search-name">
                                    <label>員工編號</label>
                                </div>
                                <div class="search-input">
                                    <input id="txtEmpNo" name="txtEmpNo" type="text" value="" class="form-control">
                                </div>
                            </div>
                            <div class="col-xs-6">
                                <div class="search-name">
                                    <label>員工姓名</label>
                                </div>
                                <div class="search-input">
                                    <input id="txtEmpName" name="txtEmpName" type="text" value="" class="form-control">
                                </div>
                            </div>
                        </div>
                        <div class="search-section">
                            <div class="col-xs-12" style="text-align:center">
                                <input id="btnEmpQuery" name="btnEmpQuery" type="button" value="查詢" class="btn btn-info" />
                                <input id="btnEmpClear" name="btnEmpClear" type="button" value="清除" class="btn btn-warning" />
                            </div>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="table-responsive" style="height:400px; overflow-y:scroll">
                        <table tabindex="0" cellspacing="0" cellpadding="0" border="0" class="table-bordered ui-jqgrid ui-widget ui-widget-content ui-corner-all" style="height:50px;width:100%">
                            <tr class="ui-jqgrid-labels" role="rowheader" style="height:40px;color:#777">
                                <th style="width:5%;text-align:center;">
                                    <div id="jqgh_grid-table_code" style="text-align:center;"><input type="checkbox" name="ChkEmpAll" /></div>
                                </th>
                                <th style="width:35%">
                                    <div id="jqgh_grid-table_code" style="text-align:center;">部門名稱</div>
                                </th>
                                <th style="width:30%">
                                    <div id="jqgh_grid-table_code" style="text-align:center;">員工編號</div>
                                </th>
                                <th style="width:30%">
                                    <div id="jqgh_grid-table_code" style="text-align:center;">員工姓名</div>
                                </th>
                            </tr>
                            <tbody id="resultDataTbody"></tbody>
                        </table>
                    </div>
                    <div id="pageDataDiv"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="btnConfirm" type="button" class="btn btn-success"> @HRPortal.MultiLanguage.DDMC_PFA.Resource.Confirm</button>
                <button id="btnClose" type="button" class="btn btn-default"> @HRPortal.MultiLanguage.DDMC_PFA.Resource.BtnClose</button>
            </div>
        </div>
    </div>
}
<script type="text/javascript">
    var sAid = "", sCompany = "", sDept = "", sEmpNo = "", sEmpName = "";

    $(function () {
        //關閉
        $("#btnClose,#btnExit").click(function () {
            $("#EmpDialog").modal('hide');
        });

        //清除
        $("#btnEmpClear").click(function () {
            $("#ddlDept").val("");
            $("#txtEmpNo").val("");
            $("#txtEmpName").val("");
            $("#resultDataTbody").empty();
        });

        //查詢
        $("#btnEmpQuery").click(function () {
            sAid = $("#txtPfaDeptID").val();
            sDept = $("#ddlDept").val();
            sEmpNo = $("#txtEmpNo").val();
            sEmpName = $("#txtEmpName").val();
            sCompany = $("#txtCompanyID").val();

            var submitData = new FormData();
            submitData.append("txtPfaDeptID", sAid);
            submitData.append("ddlDept", sDept);
            submitData.append("txtEmpNo", sEmpNo);
            submitData.append("txtEmpName", sEmpName);
            submitData.append("txtCompanyID", sCompany);

            $.ajax({
                url: "PfaDept/AddEmp",
                type: "POST",
                data: submitData,
                contentType: false,
                processData: false,
                success: function (result) {
                    $("#resultDataTbody").empty().append(result.data);
                }
            });
        });

        //確定
        $("#btnConfirm").click(function () {
            var chk = "";

            $("input[name='ChkEmp']:checked").each(function () {
                if (chk.length > 0)
                    chk = chk + "|";

                chk = chk + $(this).val();
            });

            if (chk == "") {
                showAlertMessage("請選擇員工");
            }
            else {
                var submitData = new FormData();
                submitData.append("txtPfaDeptID", sAid);
                submitData.append("selEmps", chk);

                $.ajax({
                    url: "PfaDept/SavePfaDeptEmp",
                    type: "POST",
                    data: submitData,
                    contentType: false,
                    processData: false,
                    success: function (result) {
                        var message = result.message;
                        showAlertMsg(message, function () {
                            if (result.success) {
                                $('#EmpDialog').modal('hide');
                                $('#PfaDeptDialogContent').load(selEmpUrl);
                            }
                        });
                    }
                });
            }
        });

        //全選
        $("input[name='ChkEmpAll']").click(function () {
            $("input[name='ChkEmp']").prop("checked", $(this).prop("checked"));
        });
    });
</script>