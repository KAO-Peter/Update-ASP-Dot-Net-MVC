@{
    Layout = null;
}
<!DOCTYPE html>
<html lang="zh-tw">
<head>
     @{  //20171225 Daniel 調整位置並增加isSignOnly判斷
         string siteType = HRPortal.Services.Models.SiteFunctionInfo.SiteType;
         bool isMobile = (siteType == "mobile");
         bool isOutside = (siteType == "outside");
         bool isSignOnly = (siteType == "signonly");
    }

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="" />
    <title>@CurrentUser.SystemName</title>
    @Styles.Render("~/content/site?14441")
    @Styles.Render("~/content/grid")
    @Styles.Render("~/content/multipleSelectCSS")
    @Styles.Render("~/content/form")
    @Scripts.Render("~/bundles/jquery1")
    @Scripts.Render("~/bundles/site")
    @Scripts.Render("~/bundles/multipleSelectJS")


    <link rel="icon" sizes="192x192" href="@Url.Content("~/Images/ICON_192_192.png?v=ddmc")" />
    <link rel="icon" sizes="196x196" href="@Url.Content("~/Images/ICON_196_196.png?v=ddmc")" />
    <link rel="icon" sizes="128x128" href="@Url.Content("~/Images/ICON_128_128.png?v=ddmc")" />
    <link rel="apple-touch-icon" sizes="57x57" href="@Url.Content("~/Images/apple-touch-icon-76x76.png?v=ddmc")" />
    <link rel="apple-touch-icon" sizes="152x152" href="@Url.Content("~/Images/apple-touch-icon-152x152.png?v=ddmc")" />
    <link rel="apple-touch-icon" sizes="180x180" href="@Url.Content("~/Images/apple-touch-icon-180x180.png?v=ddmc")" />
    <link rel="apple-touch-icon" sizes="144x144" href="@Url.Content("~/Images/apple-touch-icon-144x144.png?v=ddmc")" />

    @RenderSection("header", required: false)
    <script type="text/javascript">
        $(document).ready(function () {
            var mylang = getCookie('lang');
            if (mylang == null) {
                document.cookie = 'lang=zh-TW;path=/';
                mylang = "zh-TW"; //補上預設語系，讓一開始進入網頁就會顯示繁體中文
                //location.reload(); //一開始進系統沒設定過語系的，會使用預設語系，頁面不需要重新載入
            }
            $("#siteLang").val(mylang);
            //點擊選單收合  Irving  2016/10/20
            $("#arrow").click(function () {
                $("#Menu").hide();
                $("#_Menu").show();
                $("#page-wrapper").css("margin", "0 0 0 0px");
            })
            $("#_Menu").click(function () {
                $("#_Menu").hide();
                $("#Menu").show();
                $("#page-wrapper").css("margin", "0 0 0 200px");
            })
            //End Irving
        });

        function getCookie(name) {
            var nameEQ = name + "=";
            var ca = document.cookie.split(';');
            for (var i = 0; i < ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
        }

        function SetSiteLang(mylang) {
            document.cookie = 'lang=' + mylang + ';path=/';
            location.reload();
        }


    </script>
    <style>
        #myModal {
            -webkit-overflow-scrolling: touch !important;
        }

        .preventBackgroundScroll {
            overflow: hidden;
            -webkit-overflow-scrolling: auto;
            position:relative;
            /*height:100%;*/
            left:0;
            top:0;
        }
    </style>
</head>
<body>
    <input type="hidden" id="encryptKey" value='@Session["PublicKey"]' />
    <div id="wrapper">
        <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>   
            </div>
            
            <div id="Menu" class="navbar-default sidebar" role="navigation">
                <div id="myNavbar"  class="sidebar-nav navbar-collapse">
                    <ul class="nav" id="side-menu">
                        <li class="sidebar-search">
                            <div class="input-group custom-search-form">
                                <input id="menu-search" type="text" class="form-control" placeholder="搜尋" style="width: 120px;">@*@GetLanguage("common/search")*@
                                <span class="input-group-btn" style="width: 30px;">
                                    <button class="btn btn-primary" type="button">
                                        <i class="fa fa-search"></i>
                                    </button>
                                </span>
                                <span id="arrow" class="input-group-btn" style="width: 30px;">
                                    <button class="btn btn-primary" type="button" style="background-color: #f8f8f8; color: #333; border: #f8f8f8 1px solid;">
                                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                                    </button>
                                </span>
                            </div>
                        </li>
                        @if (!isSignOnly)
                        {
                        <li class="sidebar-menu">
                            <a id="menu-Home" href="~/Home">@HRPortal.MultiLanguage.Resource.HomePage</a>
                        </li>
                        }
                        @foreach (var item in GetMenus())
                        {
                            <li class="sidebar-menu">
                                @if (getLanguageCookie() == "en-US")
                                { 
                                    <a id="menu-@item.Alias" @(Html.Raw(GetCurrentMenu().Alias == item.Alias ? "class=\"active\"" : "")) href="@(String.IsNullOrWhiteSpace(item.Link) ? "#" : Url.Content(item.Link))">@item.Alias@Html.Raw(GetMenus(item).Any() ? "<span class='fa arrow'></span>" : "")</a>
                                }
                                else
                                {
                                    <a id="menu-@item.Alias" @(Html.Raw(GetCurrentMenu().Alias == item.Alias ? "class=\"active\"" : "")) href="@(String.IsNullOrWhiteSpace(item.Link) ? "#" : Url.Content(item.Link))">@item.Title@Html.Raw(GetMenus(item).Any() ? "<span class='fa arrow'></span>" : "")</a>
                                }
                                @if (GetMenus(item).Any())
                                {
                                    <ul class="nav nav-second-level collapse">
                                        @foreach (var subitem in GetMenus(item))
                                        {
                                            if (getLanguageCookie() == "en-US")
                                            { 
                                            <li>
                                                <a id="menu-@subitem.Alias" href="@(String.IsNullOrWhiteSpace(subitem.Link) ? "#" : Url.Content(subitem.Link))">@subitem.Alias</a>
                                            </li>
                                            }
                                            else
                                            {
                                            <li>
                                                <a id="menu-@subitem.Alias" href="@(String.IsNullOrWhiteSpace(subitem.Link) ? "#" : Url.Content(subitem.Link))">@subitem.Title</a>
                                            </li>
                                            }

                                        }
                                    </ul>
                                }
                            </li>
                        }
                        @*<li class="sidebar-menu">
                            <a id="menu-ChangePassword" data-modal="" href="@Url.Action("ChangePassword", "Login")">變更密碼</a>
                        </li>*@
                    </ul>
                </div>
            </div>
            <div id="topBar" class="col-xs-12 col-sm-9 col-md-8">
                <a id="company-bar" class="navbar-brand"><img src="~/Images/ICON_Year_lOGO.png?v=ddmc" width="32" height="32" border="0" style="float:left" >@(getLanguageCookie() == "en-US" ? CurrentUser.SystemEnglishName : CurrentUser.SystemName)</a>
                <p id="name-bar" class="navbar-text navbar-text col-xs-12 col-sm-9"style="font-size: 40px; color:blue; margin:0 auto; text-align:center;"><i class="fa fa-user"></i>&nbsp;@Html.Raw(getLanguageCookie() == "en-US" ? CurrentUser.Employee.EmployeeEnglishName : CurrentUser.Name)</p>
            </div>
            <ul class="nav navbar-nav navbar-top-links navbar-right">
                <li>
                    @*<p class="navbar-text"><i class="fa fa-building-o"></i>&nbsp;@(getLanguageCookie() == "en-US" ? CurrentUser.CompanyEnglishName : CurrentUser.CompanyName)</p>*@
                </li>
                <li>
                   @* <p class="navbar-text"><i class="fa fa-user"></i>&nbsp;@CurrentUser.Name</p>*@
                </li>
                <li>
                    <p class="navbar-text">
                        <i class="fa fa-language"></i>&nbsp;
                        <select name="siteLang" id="siteLang" onchange="SetSiteLang(this.value);">
                            <option value="zh-TW">繁體中文</option>
                            <!--
                            <option value="zh-CN">簡體中文</option>
                            -->
                            <option value="en-US">English</option>
                            
                        </select>
                    </p>
                </li>
                <li>
                    <a href="~/ADLogin/logout">
                    <!--<a href="~/Login/logout">-->
                        <i class="fa fa-sign-out fa-fw"></i>&nbsp;@HRPortal.MultiLanguage.Resource.LogOutt@*@GetLanguage("account/logout")*@
                    </a>
                </li>
            </ul>

            <!--選單縮小時的按鈕-->
            <div id="_Menu" class="navbar-default sidebar" role="navigation" style="display: none; width: 30px">
                <span class="input-group-btn" style="width: 30px;">
                    <button class="btn btn-primary" type="button" style="background-color: #f8f8f8; color: #333; border: #f8f8f8 1px solid;">
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </button>
                </span>
            </div>
            
        </nav>
        <div id="page-wrapper">
            <div class="container-fluid">
                <div class="page-content">
                    <div class="page-header h3">
                        <div>
                               @{
                                   //20170324修改 by Daniel，外網與行動站台不顯示薪資查詢按鈕
                                   //20170328修改 by Daniel，改為使用Global變數
                                   //string siteType = HRPortal.Services.Models.SiteFunctionInfo.SiteType;
                                   //bool isMobile = (siteType == "mobile");
                                   //bool isOutside = (siteType == "outside");
                                   
                                   if (!isSignOnly) //20180321 Daniel 不是簽核專用網站才顯示上方按鈕
                                   {
                                    <button id="_index" class="btn btn-primary" type="button" style="margin-bottom: 10px; margin-left: 15px;">
                                        @HRPortal.MultiLanguage.Resource.Home
                                    </button>
                                   
                            
                                    <button id="_leaveApplication" class="btn btn-primary" type="button" style="margin-bottom: 10px; background-color:#f0ad4e; border:0px;">
                                        @HRPortal.MultiLanguage.Resource.Leavework
                                    </button>
                                   }
                            /*<button id="_Vacancies" class="btn btn-primary" type="button" style="margin-bottom: 10px; background-color:#5f297c; border:0px;">
                             @HRPortal.MultiLanguage.Resource.Vacancies
                         </button>
                            <button id="_EmployeeBenefits" class="btn btn-primary" type="button" style="margin-bottom: 10px; background-color:#5f297c; border:0px;">
                             @HRPortal.MultiLanguage.Resource.EmployeeBenefits
                         </button>
                            <button id="_IndexAnnounceList" class="btn btn-primary" type="button" style="margin-bottom: 10px; background-color:#d9534f; border:0px;">
                             @HRPortal.MultiLanguage.Resource.Companymessage
                         </button>
                                if (!isMobile)
                                {
                            <button id="_ReadToday" class="btn btn-primary" type="button" style="margin-bottom: 10px; background-color:#d9534f; border:0px;">
                             @HRPortal.MultiLanguage.Resource.GroupMessage                                
                         </button>
                                }
                                if (!isMobile)
                                {
                            <button id="_Personnelspecification" class="btn btn-primary" type="button" style="margin-bottom: 10px; background-color:#d9534f; border:0px;">
                             @HRPortal.MultiLanguage.Resource.Personnelspecification
                         </button>
                                }
                                if (!isMobile)
                                {
                            <button id="_WebLinkListFEDS" class="btn btn-primary" type="button" style="margin-bottom: 10px; background-color:rgba(80, 20, 111, 0.91); border:0px;">
                             @HRPortal.MultiLanguage.Resource.QuickLinks
                         </button>
                            }
                                    if (!(isMobile || isOutside))
                                    {
                         @*<button id="_salarySearch" class="btn btn-primary" type="button" style="margin-bottom: 10px; background-color:#5cb85c; border:0px;">
                             @HRPortal.MultiLanguage.Resource.SalarySearch
                         </button>*@
                                    }*/
                                   }
                        </div>
                        @if (GetCurrentMenu().Alias == "LeaveForm")
                        {
                            @HRPortal.MultiLanguage.Resource.LeaveForm;
                        }
                        else if (GetCurrentMenu().Alias == "OverTimeForm")
                        {
                            @HRPortal.MultiLanguage.Resource.OvertimeApprovalRequestForm;
                        }
                        else
                        {
                            if (getLanguageCookie() == "en-US")
                            {
                            @GetCurrentMenu().Alias;
                            }
                            else
                            { 
                            @GetCurrentMenu().Title;
                            }

                        }
                        @if (GetTabs(GetCurrentMenu()).Any())
                        {
                            <ul class="nav nav-tabs nav-tabs-simple">
                                @foreach (var subitem in GetTabs(GetCurrentMenu()))
                                {
                                    if (GetCurrentPage().Link == subitem.Link)
                                    {
                                        <li class="active">
                                            <a id="tab-@subitem.Alias" href="@Url.Content(subitem.Link)">@subitem.Title</a>
                                        </li>
                                    }
                                    else
                                    {
                                        <li>
                                            <a id="tab-@subitem.Alias" href="@Url.Content(subitem.Link)">@subitem.Title</a>
                                        </li>
                                    }
                                }

                            </ul>
                        }
                    </div>
                    @RenderBody()
                </div>
            </div>
        </div>


    </div>
    <div id="loadingWidget">
        <div id="loadingWidget-text" class="alert alert-warning"><i class="fa fa-spinner fa-spin"></i><strong>載入中@*@GetLanguage("common/loading")*@...</strong></div>
    </div>
    <div id='ChangePasswordDialogDiv' class='modal fade in' role="dialog">
        <div id='ChangePasswordDialogContent'></div>
    </div>
    @*@RenderPage("_ChangePassword.cshtml")*@
    <!--[if lt IE 9]>
        @Styles.Render("~/content/ie8")
        @Scripts.Render("~/bundles/ie8")
        @Scripts.Render("~/bundles/jquery1")
    <![endif]-->
    <!--[if gte IE 9]><!-->
    @*@Scripts.Render("~/bundles/jquery2")*@
    @*@Scripts.Render("~/bundles/jquery1")*@
    <!--<![endif]-->
    <script>
        $(function () {
            $('#menu-@GetCurrentMenu().Alias').addClass('active').parents('ul').collapse('show').parents('li').addClass('active');
        });
    </script>
    @*@Scripts.Render("~/bundles/site")*@
    @Scripts.Render("~/bundles/validate")
    <script>
        $(function () {
            $.ajaxSetup({
                headers: {
                    'RequestVerificationToken': '@GetAntiForgeryToken()',
                    "cache-control": "no-cache"
                },
                complete: function (xhr) {
                    if (xhr.getResponseHeader('X-Responded-JSON') != null) {
                        var responded = jQuery.parseJSON(xhr.getResponseHeader('X-Responded-JSON'));
                        if (responded.status == 401)
                            window.location = '@Url.Content("~/ADLogin")';
                            //window.location = '@Url.Content("~/Login")';
                    }
                }
            });
            $(document).ajaxSend(function (event, jqXHR, ajaxOptions) {
                if (ajaxOptions.screenlock != null) {
                    if (ajaxOptions.screenlock == true)
                        $("#loadingWidget").show();
                }
                else {
                    $("#loadingWidget").show();
                }
            });
            $(document).ajaxComplete(function (event, jqXHR, ajaxOptions) {
                //debugger;
                //console.log('jqXHR');
                //console.log(jqXHR);
                //console.log('ajaxOptions');
                //console.log(ajaxOptions);
                if (ajaxOptions.screenlock != null) {
                    if (ajaxOptions.screenlock == true)
                        setTimeout(function () {
                            $("#loadingWidget").hide();
                        }, 500);
                }
                else {
                    setTimeout(function () {
                        $("#loadingWidget").hide();
                    }, 500);
                }
            });
            $("#menu-search").keyup(function () {
                var s = $(this).val();
                if (s.length === 0) {
                    $('ul', '.sidebar-menu').removeClass('in');
                    $('a', '.sidebar-menu').each(function (index) {
                        $(this).fadeIn();
                    });
                    return;
                }

                $('.sidebar-menu > a').each(function (index) {
                    var objItemA = $(this);
                    var vflag = false;
                    var vshow = false;
                    $(this).parent().find(' > ul a').each(function (index) {
                        if ($(this).text().search(s) === -1) {
                            $(this).fadeOut();
                        }
                        else {
                            if (!vflag) {
                                $(objItemA).fadeIn();
                                vshow = true;
                            }
                            $(this).fadeIn();
                            vflag = true;
                        }
                    });

                    if ($(this).text().search(s) === -1 && !vflag) {
                        $(this).fadeOut();
                        $(this).parent().find(' > ul').removeClass('in');
                    } else {
                        $(this).fadeIn();
                        $(this).parent().find(' > ul').addClass('in');
                    }

                });

            });

            $.ajaxSetup({ cache: false });
            $('#menu-ChangePassword').click(function () {
                $('#ChangePasswordDialogContent').load(this.href, function () {
                    $('#ChangePasswordDialogDiv').modal({
                        backdrop: 'static',
                        keyboard: true
                    }, 'show');
                    bindForm(this, '#ChangePasswordDialogDiv', '#ChangePasswordDialogContent', false);
                });
                return false;
            });

            $('button').click(function () {
                tabChange($(this).attr('id'));
            })

            //判斷螢幕大小 切換上方Bar Css 
            windowsResizeControl($(window).width(), $(window).height());

            $(window).resize(function () {
                windowsResizeControl($(window).width(), $(window).height());
            });

        });

        //螢幕大小偵測轉換
        function windowsResizeControl(width,height)
        {
            if (width <= 768)
            {
                $('#name-bar').css('font-size', '25px');

            } else if (width > 768)
            {
                $('#name-bar').css('font-size', '40px');
            }
        }


        //modal fade
        function bindForm(dialog, dialogDiv, dialogContent, IsRefresh, redirectURL) {
            $('form', dialog).submit(function () {
                $.ajax({
                    url: this.action,
                    type: this.method,
                    data: $(this).serialize(),
                    success: function (result) {
                        if (result.success) {
                            $(dialogDiv).modal('hide');
                            // Refresh:
                            if (IsRefresh && redirectURL != null)
                                window.location = redirectURL;
                            else if (IsRefresh)
                                location.reload();
                        } else {
                            $(dialogContent).html(result);
                            bindForm();

                        }
                    }
                });
                return false;
            });
        }

        //Show alert message
        function showAlertMessage(msg, callbackfunction) {
            bootbox.alert("<div style='text-align:center'>" + msg + "</div>", callbackfunction);
        }

        function showAlertMsg(msg, callbackfunction) {
            bootbox.alert("<div style='text-align:center'>" + msg + "</div>", callbackfunction);
            if (callbackfunction == undefined) {
                setModalopen();
            }
        }

        function setModalopen() {
            $('.bootbox.modal').on('hidden.bs.modal', function () {
                if ($(".modal").hasClass('in')) {
                    $('body').addClass('modal-open');
                }
            });
        }

        function showConfirm(msg, callbackfunction) {
            bootbox.dialog({
                message: msg,

                buttons: {
                    "OK": {
                        className: "btn-primary",
                        callback: callbackfunction
                    },

                    "Cancel": {
                        className: "btn-default",
                        callback: function () { }
                    }
                }
            });
        }
        function onChangePasswordSuccess() {
            $('#ChangePasswordDialogDiv').modal('hide');
        }

        //頁籤
        function tabChange(id)
        {
            if (id == '_index')
            {
                if (url('2') == "Home") {
                    window.location.href = '@Url.Action("Index", "Home", new { tab = "_index" })';
                } else {
                    window.location.href = '../Home?tab=_index';
                }
                
            } else if (id == '_leaveApplication')
            {
                if (url('2') == "Home") {
                    window.location.href = '@Url.Action("Index", "Home", new { tab = "_leaveApplication" })';
                } else {
                    window.location.href = '../Home?tab=_leaveApplication';
                }
            }  else if (id == '_Vacancies')
            {
                if (url('2') == "Home") {
                    window.location.href = '@Url.Action("Index", "Home", new { tab = "_Vacancies" })';
                } else {
                    window.location.href = '../Home?tab=_Vacancies';
                }
            } else if (id == '_EmployeeBenefits')
            {
                if (url('2') == "Home") {
                    window.location.href = '@Url.Action("Index", "Home", new { tab = "_EmployeeBenefits" })';
                } else {
                    window.location.href = '../Home?tab=_EmployeeBenefits';
                }
            } else if (id == '_IndexAnnounceList')
            {
                if (url('2') == "Home") {
                    window.location.href = '@Url.Action("Index", "Home", new { tab = "_IndexAnnounceList" })';
                } else {
                    window.location.href = '../Home?tab=_IndexAnnounceList';
                }
            } else if (id == '_ReadToday')
            {
                if (url('2') == "Home") {
                    window.location.href = '@Url.Action("Index", "Home", new { tab = "_ReadToday" })';
                } else {
                    window.location.href = '../Home?tab=_ReadToday';
                }
            } else if (id == '_Personnelspecification')
            {
                if (url('2') == "Home") {
                    window.location.href = '@Url.Action("Index", "Home", new { tab = "_Personnelspecification" })';
                } else {
                    window.location.href = '../Home?tab=_Personnelspecification';
                }
            } else if (id == '_WebLinkListFEDS')
            {
                if (url('2') == "Home") {
                    window.location.href = '@Url.Action("Index", "Home", new { tab = "_WebLinkListFEDS" })';
                } else {
                    window.location.href = '../Home?tab=_WebLinkListFEDS';
                }
            }

        }

    </script>
    @RenderSection("scripts", required: false)
    @RenderSection("footer", required: false)
</body>
</html>
