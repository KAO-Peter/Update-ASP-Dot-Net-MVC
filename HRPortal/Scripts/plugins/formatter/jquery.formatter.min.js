/*!
 * v0.1.5
 * Copyright (c) 2014 First Opinion
 * formatter.js is open sourced under the MIT license.
 *
 * thanks to digitalBush/jquery.maskedinput for some of the trickier
 * keycode handling
 */
(function(n,t){typeof define=="function"&&define.amd?define(["jQuery"],t):typeof exports=="object"?t(require("jQuery")):t(n.jQuery)})(this,function(){var r=function(){var t={},n=4,i=new RegExp("{{([^}]+)}}","g"),r=function(n){for(var t=[],r;r=i.exec(n);)t.push(r);return t};return t.parse=function(t){var f={inpts:{},chars:{}},e=r(t),s=t.length,u=0,o=0,i=0,h=function(t){for(var e=t.length,r=0;r<e;r++)f.inpts[o]=t.charAt(r),o++;u++;i+=t.length+n-1};for(i;i<s;i++)u<e.length&&i===e[u].index?h(e[u][1]):f.chars[i-u*n]=t.charAt(i);return f.mLength=i-u*n,f},t}(),t=function(){var n={},t=typeof navigator!="undefined"?navigator.userAgent:null;return n.extend=function(n){for(var i,t=1;t<arguments.length;t++)for(i in arguments[t])n[i]=arguments[t][i];return n},n.addChars=function(n,t,i){return n.substr(0,i)+t+n.substr(i,n.length)},n.removeChars=function(n,t,i){return n.substr(0,t)+n.substr(i,n.length)},n.isBetween=function(n,t){return t.sort(function(n,t){return n-t}),n>t[0]&&n<t[1]},n.addListener=function(n,t,i){return typeof n.addEventListener!="undefined"?n.addEventListener(t,i,!1):n.attachEvent("on"+t,i)},n.preventDefault=function(n){return n.preventDefault?n.preventDefault():n.returnValue=!1},n.getClip=function(n){return n.clipboardData?n.clipboardData.getData("Text"):window.clipboardData?window.clipboardData.getData("Text"):void 0},n.getMatchingKey=function(n,t,i){var r,u;for(r in i)if(u=i[r],n===u.which&&t===u.keyCode)return r},n.isDelKeyDown=function(t,i){return n.getMatchingKey(t,i,{backspace:{which:8,keyCode:8},"delete":{which:46,keyCode:46}})},n.isDelKeyPress=function(t,i){return n.getMatchingKey(t,i,{backspace:{which:8,keyCode:8,shiftKey:!1},"delete":{which:0,keyCode:46}})},n.isSpecialKeyPress=function(t,i){return n.getMatchingKey(t,i,{tab:{which:0,keyCode:9},enter:{which:13,keyCode:13},end:{which:0,keyCode:35},home:{which:0,keyCode:36},leftarrow:{which:0,keyCode:37},uparrow:{which:0,keyCode:38},rightarrow:{which:0,keyCode:39},downarrow:{which:0,keyCode:40},F5:{which:116,keyCode:116}})},n.isModifier=function(n){return n.ctrlKey||n.altKey||n.metaKey},n.forEach=function(n,t,i){var r,f,u;if(n.hasOwnProperty("length")){for(r=0,f=n.length;r<f;r++)if(t.call(i,n[r],r,n)===!1)break}else for(u in n)if(n.hasOwnProperty(u)&&t.call(i,n[u],u,n)===!1)break},n}(),u=function(n,t){function r(r){var u=[],f=[],e;return t.forEach(r,function(r){t.forEach(r,function(t,r){var e=n.parse(t),o=i(r);return u.push(o),f.push(e),!1})}),e=function(n){var i;return t.forEach(u,function(t,r){if(t.test(n))return i=r,!1}),i===undefined?null:f[i]},{getPattern:e,patterns:f,matchers:u}}var i=function(n){return n==="*"?/.*/:new RegExp(n)};return r}(r,t),f=function(){var n={};return n.get=function(n){var t;if(typeof n.selectionStart=="number")return{begin:n.selectionStart,end:n.selectionEnd};if(t=document.selection.createRange(),t&&t.parentElement()===n){var i=n.createTextRange(),u=n.createTextRange(),r=n.value.length;return(i.moveToBookmark(t.getBookmark()),u.collapse(!1),i.compareEndPoints("StartToEnd",u)>-1)?{begin:r,end:r}:{begin:-i.moveStart("character",-r),end:-i.moveEnd("character",-r)}}return{begin:0,end:0}},n.set=function(n,t){if(typeof t!="object"&&(t={begin:t,end:t}),n.setSelectionRange)n.focus(),n.setSelectionRange(t.begin,t.end);else if(n.createTextRange){var i=n.createTextRange();i.collapse(!0);i.moveEnd("character",t.end);i.moveStart("character",t.begin);i.select()}},n}(),i=function(n,t,i){function r(t,r){var u=this;if(u.el=t,!u.el)throw new TypeError("Must provide an existing element");if(u.opts=i.extend({},f,r),typeof u.opts.pattern!="undefined"&&(u.opts.patterns=u._specFromSinglePattern(u.opts.pattern),delete u.opts.pattern),typeof u.opts.patterns=="undefined")throw new TypeError("Must provide a pattern or array of patterns");u.patternMatcher=n(u.opts.patterns);u._updatePattern();u.hldrs={};u.focus=0;i.addListener(u.el,"keydown",function(n){u._keyDown(n)});i.addListener(u.el,"keypress",function(n){u._keyPress(n)});i.addListener(u.el,"paste",function(n){u._paste(n)});u.opts.persistent&&(u._processKey("",!1),u.el.blur(),i.addListener(u.el,"focus",function(n){u._focus(n)}),i.addListener(u.el,"click",function(n){u._focus(n)}),i.addListener(u.el,"touchstart",function(n){u._focus(n)}))}var f={persistent:!1,repeat:!1,placeholder:" "},u={"9":/[0-9]/,a:/[A-Za-z]/,"*":/[A-Za-z0-9]/};return r.addInptType=function(n,t){u[n]=t},r.prototype.resetPattern=function(i){this.opts.patterns=i?this._specFromSinglePattern(i):this.opts.patterns;this.sel=t.get(this.el);this.val=this.el.value;this.delta=0;this._removeChars();this.patternMatcher=n(this.opts.patterns);var r=this.patternMatcher.getPattern(this.val);this.mLength=r.mLength;this.chars=r.chars;this.inpts=r.inpts;this._processKey("",!1,!0)},r.prototype._updatePattern=function(){var n=this.patternMatcher.getPattern(this.val);n&&(this.mLength=n.mLength,this.chars=n.chars,this.inpts=n.inpts)},r.prototype._keyDown=function(n){var t=n.which||n.keyCode;if(t&&i.isDelKeyDown(n.which,n.keyCode))return this._processKey(null,t),i.preventDefault(n)},r.prototype._keyPress=function(n){var t,r;return t=n.which||n.keyCode,r=i.isSpecialKeyPress(n.which,n.keyCode),!i.isDelKeyPress(n.which,n.keyCode)&&!r&&!i.isModifier(n)?(this._processKey(String.fromCharCode(t),!1),i.preventDefault(n)):void 0},r.prototype._paste=function(n){return this._processKey(i.getClip(n),!1),i.preventDefault(n)},r.prototype._focus=function(){var n=this;setTimeout(function(){var i=t.get(n.el),r=i.end>n.focus,u=i.end===0;(r||u)&&t.set(n.el,n.focus)},0)},r.prototype._processKey=function(n,r,u){if(this.sel=t.get(this.el),this.val=this.el.value,this.delta=0,this.sel.begin!==this.sel.end)this.delta=-1*Math.abs(this.sel.begin-this.sel.end),this.val=i.removeChars(this.val,this.sel.begin,this.sel.end);else if(r&&r===46)this._delete();else if(r&&this.sel.begin-1>=0)this.val=i.removeChars(this.val,this.sel.end-1,this.sel.end),this.delta-=1;else if(r)return!0;r||(this.val=i.addChars(this.val,n,this.sel.begin),this.delta+=n.length);this._formatValue(u)},r.prototype._delete=function(){while(this.chars[this.sel.begin])this._nextPos();this.sel.begin<this.val.length&&(this._nextPos(),this.val=i.removeChars(this.val,this.sel.end-1,this.sel.end),this.delta=-1)},r.prototype._nextPos=function(){this.sel.end++;this.sel.begin++},r.prototype._formatValue=function(n){this.newPos=this.sel.end+this.delta;this._removeChars();this._updatePattern();this._validateInpts();this._addChars();this.el.value=this.val.substr(0,this.mLength);(typeof n=="undefined"||n===!1)&&t.set(this.el,this.newPos)},r.prototype._removeChars=function(){var r,n;for(this.sel.end>this.focus&&(this.delta+=this.sel.end-this.focus),r=0,n=0;n<=this.mLength;n++){var f=this.chars[n],e=this.hldrs[n],t=n+r,u;t=n>=this.sel.begin?t+this.delta:t;u=this.val.charAt(t);(f&&f===u||e&&e===u)&&(this.val=i.removeChars(this.val,t,t+1),r--)}this.hldrs={};this.focus=this.val.length},r.prototype._validateInpts=function(){for(var n=0;n<this.val.length;n++){var t=this.inpts[n],r=!u[t],f=!r&&!u[t].test(this.val.charAt(n)),e=this.inpts[n];(r||f)&&e&&(this.val=i.removeChars(this.val,n,n+1),this.focusStart--,this.newPos--,this.delta--,n--)}},r.prototype._addChars=function(){var n,t;if(this.opts.persistent){for(n=0;n<=this.mLength;n++)this.val.charAt(n)||(this.val=i.addChars(this.val,this.opts.placeholder,n),this.hldrs[n]=this.opts.placeholder),this._addChar(n);while(this.chars[this.focus])this.focus++}else for(t=0;t<=this.val.length;t++){if(this.delta<=0&&t===this.focus)return!0;this._addChar(t)}},r.prototype._addChar=function(n){var t=this.chars[n];if(!t)return!0;i.isBetween(n,[this.sel.begin-1,this.newPos+1])&&(this.newPos++,this.delta++);n<=this.focus&&this.focus++;this.hldrs[n]&&(delete this.hldrs[n],this.hldrs[n+1]=this.opts.placeholder);this.val=i.addChars(this.val,t,n)},r.prototype._specFromSinglePattern=function(n){return[{"*":n}]},r}(u,f,t),n="formatter";$.fn[n]=function(t){return typeof t=="object"&&this.each(function(){$.data(this,"plugin_"+n)||$.data(this,"plugin_"+n,new i(this,t))}),this.resetPattern=function(t){return this.each(function(){var i=$.data(this,"plugin_"+n);i&&i.resetPattern(t)}),this},this};$.fn[n].addInptType=function(n,t){i.addInptType(n,t)}});
//# sourceMappingURL=jquery.formatter.min.js.map
